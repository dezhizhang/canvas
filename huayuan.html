<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>粒子花圆</title>
    <style>
        body{
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #canvas{
            background: #000;
        }
    </style>
    <script src="./util.js" type="text/javascript"></script>
    <script src="./ball.js" type="text/javascript"></script>
    <script>
        window.onload = function() {
            let canvas = document.getElementById('canvas');
            let ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;


            let balls = [];
            let spring = 0.0001;
            let width = 0;
            let height = 0;

            window.onresize = function() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
                createParticles(width * height / 15000);
            }

            createParticles(width * height / 15000);


            function createParticles(num) {
                if(num !==balls.length) {
                    balls.length = 0;
                }
                for(let i=0;i<num;i++) {
                    balls.push(new Ball({
                        x:C.rp([0,width]),
                        y:C.rp([0,height]),
                        r:C.rp([3,10]),
                        fillStyle:C.createColor(),
                        vx:C.rp([-2,2]),
                        vy:C.rp([-2,2])
                    }))
                }

            }

            function change(ball,i) {
                ball.x += ball.vx;
                ball.y += ball.vy;
            
                if(ball.x - ball.r > width) {
                    ball.x = -ball.r;
                } else if(ball.x + ball.r <0) {
                    ball.x = width + ball.r;
                }

                if(ball.y - ball.r > height) {
                    ball.y = -ball.r;
                } else if(ball.y + ball.r <0) {
                    ball.y = height + ball.r;
                }
            }

            function draw(ball) {
                ball.render(ctx);
            }

            function move() {
                requestAnimationFrame(move);
                ctx.clearRect(0,0,width,height);
                balls.forEach(draw);
                balls.forEach(change);
            }
            move();
        }
    </script>
</head>
<body>
    <canvas id="canvas"></canvas>
</body>
</html>